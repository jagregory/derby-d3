<!DOCTYPE html>
<meta charset="utf-8">
<body>
<style>

path {
  fill: none;
  stroke: #000;
  stroke-width: 3px;
}

circle {
  fill: steelblue;
  stroke: #fff;
  stroke-width: 3px;
}

</style>
<script src="d3.v3.min.js"></script>
<script>

function flatten(arr) {
  return arr.reduce(function(a, b) {
    return a.concat(b)
  })
}

function firstOfEach(arr) {
  return arr.map(function(a) {
    return a[0]
  })
}

var player1 = {
  moves: [
    [
      [680, 100],
      [680, 300]
    ], [
      [680, 300],
      [180, 300]
    ], [
      [180, 300],
      [180, 100]
    ]
  ]
};

var players = [player1]

var svg = d3.select("body").append("svg")
    .attr("width", 960)
    .attr("height", 500);

var animateFunctions = players.map(function(player) {
  var paths = svg.selectAll('.path')
    .data(player.moves)
    .enter()
      .append('path')
      .attr('d', d3.svg.line().tension(0.75).interpolate('cardinal'));

  var points = svg.selectAll(".point")
    .data(flatten(player.moves))
    .enter()
      .append("circle")
      .attr("r", 4)
      .attr("transform", function (d) {
        return "translate(" + d + ")";
      });

  var circle = svg.append('circle')
      .attr("r", 13)
      .attr("transform", "translate(" + player.moves[0][0] + ")");

  var activeSegment = 0
  var trans = function() {
    if (activeSegment >= paths[0].length) {
      activeSegment = 0
    }

    circle.transition()
      .duration(5000)
      .attrTween('transform', function(d, idx) {
        var path = paths[0][activeSegment]
        var l = path.getTotalLength();
        return function (t) {
          var p = path.getPointAtLength(t * l);
          return "translate(" + p.x + "," + p.y + ")";
        }
      })
      .each('end', function() {
        activeSegment++
      })
  }

  return trans
})

function step() {
  animateFunctions.forEach(function(fn) {
    fn()
  })
}

step()

</script>
